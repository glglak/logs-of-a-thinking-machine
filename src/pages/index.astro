---
import { getCollection } from "astro:content";
import DevLayout from "@/layouts/DevLayout.astro";
import Card from "@/components/Card.astro";
import { SITE } from "@/config";

const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const totalPosts = allPosts.length;
const posts = allPosts
  .sort((a, b) => b.data.pubDatetime.valueOf() - a.data.pubDatetime.valueOf())
  .slice(0, SITE.postPerIndex);

console.log("Total posts:", totalPosts, "Showing:", posts.length);
---

<DevLayout title={SITE.title} description={SITE.desc}>
  <!-- Welcome Section -->
  <div class="mb-8 bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{SITE.title}</h1>
    <p class="text-gray-600 dark:text-gray-300 text-lg mb-4">{SITE.desc}</p>
    <div class="flex items-center gap-4 text-sm">
      <a href="/posts" class="inline-flex items-center gap-2 px-3 py-1 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">
        <span class="font-semibold">{totalPosts}</span>
        <span>Posts</span>
      </a>
      <span class="text-gray-400">â€¢</span>
      <span class="text-gray-500 dark:text-gray-400">Updated daily with AI insights</span>
    </div>
  </div>
  
  <!-- Posts Feed -->
  <div class="space-y-6">
    {posts.length > 0 ? (
      <>
        <ul class="space-y-6">
          {posts.map(post => <Card variant="h2" {...post} />)}
        </ul>
        {totalPosts > SITE.postPerIndex && (
          <div class="text-center pt-8">
            <a 
              href="/posts" 
              class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm"
            >
              View All Posts ({totalPosts})
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
              </svg>
            </a>
          </div>
        )}
      </>
    ) : (
      <div class="text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <p class="text-gray-600 dark:text-gray-400">No posts found.</p>
      </div>
    )}
  </div>
</DevLayout>
